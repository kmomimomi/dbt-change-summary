# GitHub Issue 下書き

詳細設計に基づき、以下のIssueを作成します。各Issueは、AIコーディングエージェントが実装できる単位のコンテクストサイズに分割し、明確な受け入れ条件を設定しています。

## Issue 1: プロジェクト構造のセットアップとTypeScript環境構築

**タイトル**: プロジェクト構造のセットアップとTypeScript環境構築

**説明**:
詳細設計に基づき、プロジェクトの基本構造をセットアップし、TypeScript環境を構築します。これには、必要なディレクトリ構造の作成、package.jsonの作成、TypeScriptおよびESLint/Prettierの設定が含まれます。

**タスク**:
1. 必要なディレクトリ構造の作成 (`src/`, `templates/`, `__fixtures__/`, `__tests__/` など)
2. `package.json` の作成と必要な依存関係の設定
3. TypeScript設定ファイル (`tsconfig.json`) の作成
4. ESLintとPrettierの設定ファイル作成
5. `.gitignore` の設定
6. 基本的なREADME.mdの作成

**受け入れ条件**:
- [ ] 実装済みコード: ディレクトリ構造およびすべての設定ファイルが作成されていること
- [ ] 単体テストコード: TypeScriptのコンパイルが正常に行われることを確認するテスト
- [ ] 動作確認結果: `npm run build` が正常に動作すること
- [ ] 設計ドキュメント: プロジェクト構造に関するドキュメントが更新されていること

---

## Issue 2: マニフェスト解析モジュールの実装 - 基本構造

**タイトル**: マニフェスト解析モジュールの実装 - 基本構造

**説明**:
dbtのmanifest.jsonとcatalog.jsonを読み込み、基本的な解析を行うモジュールを実装します。これは、PoCのコードを参考にしながら、TypeScriptの型安全性を活かした実装に転換します。

**タスク**:
1. `src/lib/manifest-parser.ts` の作成
2. manifest.jsonとcatalog.jsonの型定義
3. ファイル読み込み機能の実装
4. 基本的なバリデーション機能の実装

**受け入れ条件**:
- [ ] 実装済みコード: マニフェスト解析の基本モジュールが実装されていること
- [ ] 単体テストコード: ファイル読み込みとバリデーションのテスト
- [ ] 動作確認結果: テストケースが正常に実行されること
- [ ] 設計ドキュメント: モジュールの型定義とAPIについてのドキュメントが作成されていること

---

## Issue 3: 差分抽出ロジックの実装 - プロジェクトレベル

**タイトル**: 差分抽出ロジックの実装 - プロジェクトレベル

**説明**:
2つのmanifest.jsonを比較して、プロジェクトレベルの設定変更（例: varsの追加・削除、database/schemaの変更）を抽出するロジックを実装します。

**タスク**:
1. `src/lib/diff-generator.ts` の作成
2. プロジェクト設定の差分抽出関数の実装
3. 変更種別（追加、削除、変更）の判定ロジック実装

**受け入れ条件**:
- [ ] 実装済みコード: プロジェクトレベルの差分抽出モジュールが実装されていること
- [ ] 単体テストコード: 各種変更パターン（追加、削除、変更）のテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りの差分が抽出されること
- [ ] 設計ドキュメント: 差分抽出ロジックの仕様とAPIについてのドキュメントが更新されていること

---

## Issue 4: 差分抽出ロジックの実装 - ノードレベル

**タイトル**: 差分抽出ロジックの実装 - ノードレベル

**説明**:
2つのmanifest.jsonとcatalog.jsonを比較して、ノードレベルの設定変更（例: モデルやseedの追加・削除、configやmeta情報の変更）を抽出するロジックを実装します。

**タスク**:
1. `src/lib/diff-generator.ts` の拡張
2. ノードレベルの差分抽出関数の実装
3. ノード属性の変更検出ロジック実装
4. ノードの追加・削除検出ロジック実装

**受け入れ条件**:
- [ ] 実装済みコード: ノードレベルの差分抽出機能が実装されていること
- [ ] 単体テストコード: ノードの追加、削除、変更の各パターンのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りの差分が抽出されること
- [ ] 設計ドキュメント: ノードレベルの差分抽出ロジックの仕様が更新されていること

---

## Issue 5: 差分抽出ロジックの実装 - カラムレベル

**タイトル**: 差分抽出ロジックの実装 - カラムレベル

**説明**:
2つのmanifest.jsonとcatalog.jsonを比較して、カラムレベルの変更（例: カラムの追加・削除、型の変更）を抽出するロジックを実装します。

**タスク**:
1. `src/lib/diff-generator.ts` の拡張
2. カラムレベルの差分抽出関数の実装
3. カラム属性の変更検出ロジック実装
4. カラムの追加・削除検出ロジック実装

**受け入れ条件**:
- [ ] 実装済みコード: カラムレベルの差分抽出機能が実装されていること
- [ ] 単体テストコード: カラムの追加、削除、型変更の各パターンのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りの差分が抽出されること
- [ ] 設計ドキュメント: カラムレベルの差分抽出ロジックの仕様が更新されていること

---

## Issue 6: Markdown生成ロジックの実装

**タイトル**: Markdown生成ロジックの実装

**説明**:
差分抽出結果を基に、PRコメント用のMarkdownを生成するロジックを実装します。Nunjucksテンプレートエンジンを使用して、テンプレートからMarkdownを生成します。

**タスク**:
1. `src/lib/markdown-renderer.ts` の作成
2. Markdownテンプレートの作成 (`templates/pr-comment.md.njk`)
3. テンプレート変数の定義と連携
4. レンダリングロジックの実装

**受け入れ条件**:
- [ ] 実装済みコード: Markdown生成ロジックが実装されていること
- [ ] 単体テストコード: 各種差分パターンのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りのMarkdownが生成されること
- [ ] 設計ドキュメント: Markdown生成ロジックの仕様とテンプレート変数の説明が更新されていること

---

## Issue 7: Excel生成ロジックの実装 - 基本構造

**タイトル**: Excel生成ロジックの実装 - 基本構造

**説明**:
差分抽出結果と完全なマニフェストデータを基に、Excelレポートを生成するための基本ロジックを実装します。ExcelJSライブラリを使用して、基本的なExcelファイル構造を作成します。

**タスク**:
1. `src/lib/excel-generator.ts` の作成
2. Excelファイルの基本構造作成
3. スタイリング設定の実装
4. 共通ユーティリティ関数の実装

**受け入れ条件**:
- [ ] 実装済みコード: Excel生成の基本ロジックが実装されていること
- [ ] 単体テストコード: Excel生成の基本機能のテスト
- [ ] 動作確認結果: テストケースが正常に実行され、基本的なExcelファイルが生成されること
- [ ] 設計ドキュメント: Excel生成モジュールの基本設計が更新されていること

---

## Issue 8: Excel生成ロジックの実装 - プロジェクト変更シート

**タイトル**: Excel生成ロジックの実装 - プロジェクト変更シート

**説明**:
プロジェクトレベルの変更をまとめたExcelシートを生成するロジックを実装します。

**タスク**:
1. `src/lib/excel-generator.ts` の拡張
2. プロジェクト変更シートのレイアウト設計
3. プロジェクト差分データの整形と書き込みロジック

**受け入れ条件**:
- [ ] 実装済みコード: プロジェクト変更シート生成ロジックが実装されていること
- [ ] 単体テストコード: プロジェクト変更シートのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りのシートが生成されること
- [ ] 設計ドキュメント: プロジェクト変更シートの仕様が更新されていること

---

## Issue 9: Excel生成ロジックの実装 - モデル変更シート

**タイトル**: Excel生成ロジックの実装 - モデル変更シート

**説明**:
ノードレベルの変更をまとめたExcelシートを生成するロジックを実装します。

**タスク**:
1. `src/lib/excel-generator.ts` の拡張
2. モデル変更シートのレイアウト設計
3. ノード差分データの整形と書き込みロジック

**受け入れ条件**:
- [ ] 実装済みコード: モデル変更シート生成ロジックが実装されていること
- [ ] 単体テストコード: モデル変更シートのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りのシートが生成されること
- [ ] 設計ドキュメント: モデル変更シートの仕様が更新されていること

---

## Issue 10: Excel生成ロジックの実装 - カラム変更シート

**タイトル**: Excel生成ロジックの実装 - カラム変更シート

**説明**:
カラムレベルの変更をまとめたExcelシートを生成するロジックを実装します。

**タスク**:
1. `src/lib/excel-generator.ts` の拡張
2. カラム変更シートのレイアウト設計
3. カラム差分データの整形と書き込みロジック

**受け入れ条件**:
- [ ] 実装済みコード: カラム変更シート生成ロジックが実装されていること
- [ ] 単体テストコード: カラム変更シートのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りのシートが生成されること
- [ ] 設計ドキュメント: カラム変更シートの仕様が更新されていること

---

## Issue 11: Excel生成ロジックの実装 - モデル一覧シート

**タイトル**: Excel生成ロジックの実装 - モデル一覧シート

**説明**:
マニフェスト全体からモデル一覧を生成するロジックを実装します。これはリリース時のモデル一覧Excelに使用されます。

**タスク**:
1. `src/lib/excel-generator.ts` の拡張
2. モデル一覧シートのレイアウト設計
3. モデルデータの収集と整形ロジック

**受け入れ条件**:
- [ ] 実装済みコード: モデル一覧シート生成ロジックが実装されていること
- [ ] 単体テストコード: モデル一覧シートのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、期待通りのシートが生成されること
- [ ] 設計ドキュメント: モデル一覧シートの仕様が更新されていること

---

## Issue 12: GitHub API連携 - PRコメント機能

**タイトル**: GitHub API連携 - PRコメント機能

**説明**:
GitHub APIを使用して、PRにコメントを投稿する機能を実装します。

**タスク**:
1. `src/utils/github.ts` の作成
2. GitHub APIクライアントの設定
3. PRコメント投稿機能の実装
4. エラーハンドリングの実装

**受け入れ条件**:
- [ ] 実装済みコード: GitHub PRコメント機能が実装されていること
- [ ] 単体テストコード: GitHub API連携のモックテスト
- [ ] 動作確認結果: テストケースが正常に実行され、モックPRにコメントが投稿されること
- [ ] 設計ドキュメント: GitHub API連携の仕様が更新されていること

---

## Issue 13: GitHub API連携 - リリース管理機能

**タイトル**: GitHub API連携 - リリース管理機能

**説明**:
GitHub APIを使用して、リリースを作成し、アセット（Excelファイル）をアップロードする機能を実装します。

**タスク**:
1. `src/utils/github.ts` の拡張
2. リリース作成機能の実装
3. アセットアップロード機能の実装
4. エラーハンドリングの実装

**受け入れ条件**:
- [ ] 実装済みコード: GitHub リリース管理機能が実装されていること
- [ ] 単体テストコード: リリース作成とアセットアップロードのモックテスト
- [ ] 動作確認結果: テストケースが正常に実行され、モックリリースが作成されアセットがアップロードされること
- [ ] 設計ドキュメント: リリース管理機能の仕様が更新されていること

---

## Issue 14: PRコメント用アクションの実装

**タイトル**: PRコメント用アクションの実装

**説明**:
PRコメント用のGitHub Actionを実装します。これは、PRが作成されたときに実行され、変更内容をMarkdown形式でPRにコメントとして投稿します。

**タスク**:
1. `src/actions/pr-comment/action.yml` の作成
2. `src/actions/pr-comment/index.ts` の作成
3. 入力パラメータの定義
4. アクションロジックの実装

**受け入れ条件**:
- [ ] 実装済みコード: PRコメント用アクションが実装されていること
- [ ] 単体テストコード: アクションロジックのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、アクションが期待通りに動作すること
- [ ] 設計ドキュメント: PRコメント用アクションの仕様と使用方法が更新されていること

---

## Issue 15: リリース用Excelアクションの実装

**タイトル**: リリース用Excelアクションの実装

**説明**:
リリース用のGitHub Actionを実装します。これは、マージされたときに実行され、モデル一覧のExcelファイルを生成してGitHub Releaseにアップロードします。

**タスク**:
1. `src/actions/release-excel/action.yml` の作成
2. `src/actions/release-excel/index.ts` の作成
3. 入力パラメータの定義
4. アクションロジックの実装

**受け入れ条件**:
- [ ] 実装済みコード: リリース用Excelアクションが実装されていること
- [ ] 単体テストコード: アクションロジックのテスト
- [ ] 動作確認結果: テストケースが正常に実行され、アクションが期待通りに動作すること
- [ ] 設計ドキュメント: リリース用Excelアクションの仕様と使用方法が更新されていること

---

## Issue 16: CI/CDワークフローの設定

**タイトル**: CI/CDワークフローの設定

**説明**:
プロジェクトのCI/CDパイプラインを設定します。これには、PR時のテスト実行と、マージ時のリリース処理を含みます。

**タスク**:
1. `.github/workflows/ci.yml` の作成
2. `.github/workflows/release.yml` の作成
3. テスト実行ワークフローの定義
4. リリース処理ワークフローの定義

**受け入れ条件**:
- [ ] 実装済みコード: CI/CDワークフロー設定が実装されていること
- [ ] 単体テストコード: ワークフローの構文チェック
- [ ] 動作確認結果: ローカルでのワークフロー実行テスト
- [ ] 設計ドキュメント: CI/CDパイプラインの仕様と使用方法が更新されていること

---

## Issue 17: サンプルとドキュメントの作成

**タイトル**: サンプルとドキュメントの作成

**説明**:
ユーザーがアクションを使用するためのサンプル設定とドキュメントを作成します。

**タスク**:
1. サンプルワークフロー設定の作成
2. 使用方法のドキュメント作成
3. 設定オプションのリファレンス作成
4. トラブルシューティングガイドの作成

**受け入れ条件**:
- [ ] 実装済みコード: サンプルワークフロー設定が実装されていること
- [ ] ドキュメント: 使用方法のドキュメントが作成されていること
- [ ] ドキュメント: 設定オプションのリファレンスが作成されていること
- [ ] ドキュメント: トラブルシューティングガイドが作成されていること

---

## Issue 18: E2Eテストの実装

**タイトル**: E2Eテストの実装

**説明**:
実際のGitHub環境で動作するE2Eテストを実装します。

**タスク**:
1. `__tests__/e2e/` ディレクトリの設定
2. PRコメントアクションのE2Eテスト
3. リリースアクションのE2Eテスト
4. テスト用のGitHubリポジトリ設定

**受け入れ条件**:
- [ ] 実装済みコード: E2Eテストが実装されていること
- [ ] テスト環境: テスト用のGitHubリポジトリが設定されていること
- [ ] 動作確認結果: E2Eテストが正常に実行され、期待通りに動作すること
- [ ] 設計ドキュメント: E2Eテスト方法と環境設定のドキュメントが作成されていること

---

## Issue 19: パフォーマンス最適化

**タイトル**: パフォーマンス最適化

**説明**:
大規模なmanifest.jsonやcatalog.jsonに対応するためのパフォーマンス最適化を行います。

**タスク**:
1. メモリ使用量の最適化
2. 処理速度の改善
3. 大規模ファイルのベンチマークテスト

**受け入れ条件**:
- [ ] 実装済みコード: パフォーマンス最適化が実装されていること
- [ ] 単体テストコード: 大規模ファイルのテスト
- [ ] 動作確認結果: ベンチマークテストで処理時間とメモリ使用量が目標値内に収まること
- [ ] 設計ドキュメント: パフォーマンス特性と最適化手法のドキュメントが更新されていること

---

## Issue 20: リリース準備とバージョン1.0.0の公開

**タイトル**: リリース準備とバージョン1.0.0の公開

**説明**:
バージョン1.0.0のリリース準備と公開を行います。

**タスク**:
1. 最終的なテスト実行
2. CHANGELOG.mdの作成
3. バージョン番号の設定
4. リリースノートの作成
5. GitHub Releaseの作成

**受け入れ条件**:
- [ ] 実装済みコード: リリース準備タスクが完了していること
- [ ] テスト結果: すべてのテストが正常に実行されること
- [ ] ドキュメント: CHANGELOG.mdとリリースノートが作成されていること
- [ ] 成果物: GitHub Releaseが作成され、タグがつけられていること